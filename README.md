# Point Cloud Morph

Blenderで作成したGLBモデルの表面を点群として表示し、アニメーションで別のGLBモデルへモーフィングするNext.js + React Three Fiberアプリケーションです。

## 機能

- GLBモデルの表面を小さな点として表示
- 点の色はモデルが持つその点の色（頂点色またはマテリアル色）
- アニメーションによって点群を別のGLBモデルの表面へ移動
- リアルタイムでモーフィングの進行度を調整可能

## セットアップ

1. 依存関係をインストール:
```bash
npm install
```

2. GLBモデルファイルを配置:
`public/models/` ディレクトリを作成し、以下のファイルを配置してください:
- `model1.glb` - 最初のモデル
- `model2.glb` - モーフィング先のモデル

   **注意**: モデルファイルが存在しない場合、エラーがコンソールに表示されます。

3. 開発サーバーを起動:
```bash
npm run dev
```

4. ブラウザで `http://localhost:3000` を開く

## 使い方

- **スライダー**: Morph Progressスライダーでモーフィングの進行度を手動で調整できます（0% = モデル1、100% = モデル2）
- **Animate Morphボタン**: 2秒間のアニメーションで自動的にモーフィングを実行します
- **Resetボタン**: モーフィングを最初の状態（モデル1）にリセットします
- **マウス操作**: 
  - 左クリック + ドラッグ: カメラを回転
  - 右クリック + ドラッグ: カメラをパン
  - スクロール: ズームイン/アウト

## カスタマイズ

`app/page.tsx` の `PointCloudMorph` コンポーネントのプロパティを変更することで、以下の設定を調整できます:

- `pointSize`: 点のサイズ（デフォルト: 0.02）
- `pointDensity`: 点の密度（デフォルト: 0.5、大きいほど多くの点が生成されます）
  - 注意: 密度が高いとパフォーマンスに影響する可能性があります
- `model1Path`: 最初のモデルのパス（デフォルト: `/models/model1.glb`）
- `model2Path`: モーフィング先のモデルのパス（デフォルト: `/models/model2.glb`）

## 技術的な詳細

### 点群の生成方法

1. GLBモデルを読み込み、すべてのメッシュを走査
2. 各メッシュの三角形の表面に、面積に基づいて点を配置
3. バリセントリック座標を使用して、三角形内のランダムな位置に点を生成
4. 頂点色がある場合は補間して点の色を決定、ない場合はマテリアルの色を使用

### モーフィングアルゴリズム

- 2つの点群の対応する点を線形補間（lerp）で補間
- 色も同様に補間して、スムーズな色遷移を実現
- `morphProgress` パラメータ（0-1）で進行度を制御

## トラブルシューティング

### モデルが表示されない

- ブラウザのコンソールでエラーを確認してください
- GLBファイルのパスが正しいか確認してください
- GLBファイルが正しくエクスポートされているか確認してください

### パフォーマンスが悪い

- `pointDensity` の値を下げてください（例: 0.3）
- `pointSize` を小さくして、点の数を減らしてください
- モデルのポリゴン数を減らしてください

### 色が正しく表示されない

- Blenderで頂点色を設定しているか確認してください
- マテリアルに色が設定されているか確認してください
- GLBエクスポート時に「頂点色を含める」オプションが有効になっているか確認してください

## 技術スタック

- Next.js 14
- React Three Fiber
- Three.js
- @react-three/drei
- TypeScript

## ライセンス

MIT
